<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Baidu Map Widget</title>
  <style>
  html, body {
    margin: 0;
    padding: 0;
  }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    function loadScript() {
      var ak = queryString().ak || 'YIE3NeIyCU0OiZkcys9w8g7H9tKQ4KMf';
      var script = document.createElement("script");
      script.src = "http://api.map.baidu.com/api?v=2.0&ak=" + ak + "&callback=initialize"; //此为v2.0版本的引用方式
      document.body.appendChild(script);
    }

    function queryString() {
      var e = window.location.href,
        r;
      var t = e.slice(e.indexOf("?") + 1).split("&");
      var a = [];
      for (i = 0; i < t.length; i++) {
        r = t[i].split("=");
        a.push(r[0]);
        a[r[0]] = r[1]
      }
      return a
    }

    function initialize() {
      var options = queryString();
      var mapElem = document.getElementById('map');
      if(options.height) {
        console.log(options.height);
        mapElem.style.height = options.height + 'px';
      }

      var map = new BMap.Map('map');

      if (options.center) {
        var d = options.center.split(',');
        var point = new BMap.Point(d[0], d[1])
        map.centerAndZoom(point, parseInt(d[2]));
      }

      if (options.marker) {
        var d = options.marker.split(',');
        var point = new BMap.Point(d[0], d[1])

        var marker = new BMap.Marker(point);
        map.addOverlay(marker);

        if(options.markerlabel) {
          var label = decodeURI(options.markerlabel);
          marker.setLabel(new BMap.Label(label, {
            offset: new BMap.Size(0, -18)
          }));
        }
      }

      if (options.infoWindow) {
        var infoWindow = new BMap.InfoWindow(label, {
          title: 'test'
        });
        marker.addEventListener("click", function() {
          map.openInfoWindow(infoWindow, point);
        });
        map.openInfoWindow(infoWindow, point);
      }
    }

    window.onload = loadScript;
  </script>
</body>

</html>
